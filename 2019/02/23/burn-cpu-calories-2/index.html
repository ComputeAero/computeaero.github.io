<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Q: Last time, we talked about multi-threading techniques in parallel programming. I saw the 4-thread version of the code doesn’t show good speedup in your 4 core/8 thread (4C/8T) laptop, why?A: Genera">
<meta property="og:type" content="article">
<meta property="og:title" content="Burn CPU&#39;s Calories (2)">
<meta property="og:url" content="http://feilinx.com/2019/02/23/burn-cpu-calories-2/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="Q: Last time, we talked about multi-threading techniques in parallel programming. I saw the 4-thread version of the code doesn’t show good speedup in your 4 core/8 thread (4C/8T) laptop, why?A: Genera">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://feilinx.com/images/cpu.jpg">
<meta property="og:updated_time" content="2020-01-18T18:38:29.264Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Burn CPU&#39;s Calories (2)">
<meta name="twitter:description" content="Q: Last time, we talked about multi-threading techniques in parallel programming. I saw the 4-thread version of the code doesn’t show good speedup in your 4 core/8 thread (4C/8T) laptop, why?A: Genera">
<meta name="twitter:image" content="http://feilinx.com/images/cpu.jpg">






  <link rel="canonical" href="http://feilinx.com/2019/02/23/burn-cpu-calories-2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Burn CPU's Calories (2) | Blog</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-101617499-2"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-101617499-2');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://feilinx.com/2019/02/23/burn-cpu-calories-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="F.L.">
      <meta itemprop="description" content="Note on computer, IT, art, education, etc.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Burn CPU's Calories (2)

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-23 17:21:46" itemprop="dateCreated datePublished" datetime="2019-02-23T17:21:46-06:00">2019-02-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-01-18 12:38:29" itemprop="dateModified" datetime="2020-01-18T12:38:29-06:00">2020-01-18</time>
              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2019/02/23/burn-cpu-calories-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/23/burn-cpu-calories-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             Views:  
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">16k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">14 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>Q: Last time, we talked about multi-threading techniques in parallel programming. I saw the 4-thread version of the code doesn’t show good speedup in your 4 core/8 thread (4C/8T) laptop, why?</strong><br>A: Generally speaking, there are only two factors of a computer’s performance. One is the power of CPU (frequency, number of cores, number of ALU and FPU, registers, etc.), and the other is the memory, so a short answer to your question is MEMORY.<br><strong>Q: Memory? I think the memory is sufficient. The entire matrix is just 20MB, but your laptop has 12GB memory available, I believe.</strong><br>A: The size of memory is enough, but the bandwidth of memory is already saturated.<br><strong>Q: Bandwidth? What does it mean?</strong><br><a id="more"></a><br>A: It means the amount of data can be transferred from the main memory to CPU per second through the <strong>memory bus</strong>. Because the data (matrix in our example) is stored in the main memory, but the operations must be executed in CPU, so the data must be read in to the CPU’s cache and then written back to the main memory.<br><strong>Q: I still can not image the picture of data transfer.</strong><br>A: Look at the following picture. Ignore the “uncore, queue, X99 chipset, GPU etc.” for now. All the data directly accessed from CPU is from L3 cache. The data in the main memory is fetched by the memory controller to the L3 cache through the memory bus. The <strong>most important</strong> thing to be noted is all of the threads share the same memory bus, which means the bandwidth is a upper limit of the entire memory access rates of all threads.<br><img src="/images/cpu.jpg" alt="CPU"><br><strong>Q: I see, so I think there should be many kinds of bandwidth, because the data has to be transferred for many times before getting involved to the physical cores, like from memory to L3, from L3 to L2, from L2 to L1. </strong><br>A: No. The bandwidth is specifically referred to the transfer speed from memory to L3, because it is the bottleneck. Look at the following table</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Type of storage</th>
<th style="text-align:center">access latency (cycles)</th>
</tr>
</thead>
<tbody>
<tr>
<td>L1 cache</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td>L2 cache</td>
<td style="text-align:center">11-12</td>
</tr>
<tr>
<td>L3 cache</td>
<td style="text-align:center">22</td>
</tr>
<tr>
<td>Memory</td>
<td style="text-align:center">200-400</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Q: What a huge latency between L3 cache and memory!</strong><br>A: Agree, so the bandwidth is critical for all memory-intensive programs.<br><strong>Q: Wait, what do you mean by “memory-intensive program”?</strong><br>A: As I said, there are two big factors of performance. If the bottleneck of a program is the capability of computation, like number of ALU, FPU, it is called a core-intensive program. If the computation capabilities are enough, but it starves for more data from the memory, which means it suffers from the bandwidth, it is called a memory-intensive program.<br><strong>Q：I see… Now I think I can guess the solution of my question “why our program can not show much speedup with more than 3 threads”. More threads mean more data requests at the same time, so it puts more pressure to the memory controller and memory bus. For the 1-, 2-, 3-thread versions of our program, the amount of requested memory rate is not that big, so they are still core-intensive, which means more threads can provide more speedup. However, with 4 or more threads, the amount of requested memory rate hits the uppper limiter of the data transfer speed (bandwidth), so it becomes a memory-intensive program. It also explains why the time costs of 5-10 thread versions are quite similar, because all of them are limited by the same bandwidth! It means this code is never limited by computation units (e.g. ALU, FPU). Of course, there are no arithmetic operations at all.</strong><br>A: Correct! If the maximum score is 10, I would like to give you 20, because your answer already goes beyond your question.<br><strong>Q: Although I am correct, I feel sad because it means we can do nothing, except buying a new computer, to improve it anymore, because it already hits the hardware limit.</strong><br>A: Not really. In fact, the bandwidth is just in ideal situation. In most real-world cases, we can not reach that ideal bandwidth. For example, our matrix has 1800<em>2400 integer entries, so it occupies 16MB. To flip it, we need to read and write each entry once, so in total we have 16MB reading access and 16MB writing access. I did a bandwidth testing on my computer by an opensource tool (<a href="https://zsmith.co/bandwidth.php" target="_blank" rel="noopener">https://zsmith.co/bandwidth.php</a>), it shows<br>
<p style="background-color: #000000; color: #00FF00">
Sequential read (64-bit), size = 128 B, loops = 2031091712, 49582.0 MB/s <br>
Sequential write (64-bit), size = 128 B, loops = 1002438656, 24462.2 MB/s <br>
</p>
<br>Therefore, the ideal time cost of a program would be 9.87e-4 seconds. This value is valid for multi-threads programs, because it is the upper limit of memory access capability. It should be noted that the above value is just an rough estimation for reference. From our real time costs, we can see there is much space for optimization especially for vertiacal flipping. We need to do something to optimzie the memory access pattern to dig the memory access. The current pattern is not efficient.<br><strong>Q: Oh? Access pattern?</strong><br>A: Yes. It relates to the structure of the memory. The DRAM is accessed one row at a time. Each row is the smallest amount of memory to be fetched (about 2-8KB in modern DRAMs), which means even the CPU only requests 1 integer (4 Byte), the memory controller will still fetch 2-8KB data from the main memory to L3 cache. The entire latency is 200-400 cycles as stated in the table before.<br><strong>Q: Hmm… In our code, I think it requests the matrix’s entries one by one. It is tatally a waste of time.</strong><br>A: Yes. <strong>Accessing memory should be in large chunks</strong>. We hope the CPU can fetch all the needed data to the caches at first and do some flipping operations within the caches, then write them back to the main memory.<br><strong>Q: Yes, please tell the CPU “hey, put this chunk of data into the cache, and then just use data in the cache”.</strong><br>A: Unfortunately, that’s hard, almost impossible. The reason is caches are totally hideen from programmers and they are handled automatically by the OS…<br><strong>Q: … I am waiting for your “but”.</strong><br>A: But, programmers can always give some hints to the OS to use the caches more efficiently. For example, if a chunk of data is frequently used within a loop, that amount of data will be cached. Here are the memory optimized versions of our codes<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">MTFlipHMem</span><span class="params">(<span class="keyword">void</span> *tid)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *<span class="built_in">buffer</span>;</span><br><span class="line">    <span class="keyword">int</span> ts = *((<span class="keyword">int</span>*)tid);</span><br><span class="line">    ts *= row/num_threads;</span><br><span class="line">    <span class="keyword">int</span> te = ts+row/num_threads<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">buffer</span> = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=ts;i&lt;=te;i++)&#123;</span><br><span class="line">        <span class="built_in">memcpy</span>((<span class="keyword">void</span>*)<span class="built_in">buffer</span>, (<span class="keyword">void</span>*)matrix[i], col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;col/<span class="number">2</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">int</span> temp = <span class="built_in">buffer</span>[j];</span><br><span class="line">            <span class="built_in">buffer</span>[j] = <span class="built_in">buffer</span>[col-j<span class="number">-1</span>];</span><br><span class="line">            <span class="built_in">buffer</span>[col-j<span class="number">-1</span>] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memcpy</span>((<span class="keyword">void</span>*)matrix[i], (<span class="keyword">void</span>*)<span class="built_in">buffer</span>, col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(<span class="built_in">buffer</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">MTFlipVMem</span><span class="params">(<span class="keyword">void</span>* tid)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *<span class="built_in">buffer</span>, *buffer2;</span><br><span class="line">    <span class="keyword">int</span> ts = *((<span class="keyword">int</span>*) tid);</span><br><span class="line">    ts *= row/num_threads;</span><br><span class="line">    <span class="keyword">int</span> te = ts+row/num_threads<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">buffer</span> = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    buffer2= (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=ts; j&lt;=te; j++)&#123;</span><br><span class="line">        <span class="built_in">memcpy</span>((<span class="keyword">void</span>*)<span class="built_in">buffer</span>,  (<span class="keyword">void</span>*)matrix[j], col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">        <span class="built_in">memcpy</span>((<span class="keyword">void</span>*)buffer2, (<span class="keyword">void</span>*)matrix[row-j<span class="number">-1</span>], col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">memcpy</span>((<span class="keyword">void</span>*)matrix[row-j<span class="number">-1</span>],  (<span class="keyword">void</span>*)<span class="built_in">buffer</span>,  col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">        <span class="built_in">memcpy</span>((<span class="keyword">void</span>*)matrix[j],        (<span class="keyword">void</span>*)buffer2, col*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(<span class="built_in">buffer</span>);</span><br><span class="line">    <span class="built_in">free</span>(buffer2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>In the innermost loop of <strong>MTFlipHMem()</strong>, only the buffer is used and its value is got from <strong>memcpy()</strong>. In the <strong>MTFlipVMem()</strong>, the <strong>memcpy()</strong> replaces the previous one-by-one memory access pattern.<br><em>*Q: What’s the speedup of this optimization?</em></em><br>A: Look at the timing information below<br>
</p><p style="background-color: #000000; color: #00FF00">
Time cost to vertically (MT version, TH = 1) is 3.939e-02 seconds.<br>
Time cost to horizontally (MT version, TH = 1) is 4.494e-03 seconds.<br>
Time cost to vertically (MT version, TH = 2) is 2.014e-02 seconds.<br>
Time cost to horizontally (MT version, TH = 2) is 2.834e-03 seconds.<br>
Time cost to vertically (Memory Opt) (MT version, TH = 1) is 4.851e-03 seconds.<br>
Time cost to horizontally (Memory Opt) (MT version, TH = 1) is 2.868e-03 seconds.<br>
Time cost to vertically (Memory Opt) (MT version, TH = 2) is 3.607e-03 seconds.<br>
Time cost to horizontally (Memory Opt) (MT version, TH = 2) is 2.020e-03 seconds.<br>
</p>
<br>Remember our previous estimation? 9.87e-4 seconds. We are very close to it! (50% of ideal bandwidth is already very high)<br>The speedup due to the optimization of memory access pattern is summarized in the following table<p></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Tables</th>
<th style="text-align:center">speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td>vertical flip</td>
<td style="text-align:center">12X</td>
</tr>
<tr>
<td>horizontal flip</td>
<td style="text-align:center">1.4X</td>
</tr>
</tbody>
</table>
</div>
<p>The reason why the vertical flipping has much more speedup than the horizontal flipping is the horizontal flipping is already close to the ideal bandwidth limit.<br><strong>Q: Nice. Now I know the limit of the hardware and how to program the software to reach that limit. At this stage, I can say “we can not improve this program anymore on this computer” with confidence.</strong><br>A: No…You can.<br><strong>Q: Why?</strong><br>A: Look at the NVIDIA logo on my laptop, which means it has GPU card installed. When the CPU is burnning the calories at the full speed, the GPU is just sleeping there. Why not wake it up?<br><strong>Q: I am eager to dive into the GPU world.</strong><br>A: See you next time. All of today’s code is available here: <a href="https://onlinegdb.com/SJhVBUJU4" target="_blank" rel="noopener">https://onlinegdb.com/SJhVBUJU4</a>. If you want to learn more details, please go to buy the book: <a href="https://www.crcpress.com/GPU-Parallel-Program-Development-Using-CUDA/Soyata/p/book/9781498750752" target="_blank" rel="noopener">Tolga Soyata. GPU Parallel Program Development Using CUDA. Chapman and Hall/CRC, 2018.</a></p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/02/11/calculation-revolution-history/" rel="next" title="《计算进化史：改变数学的命运》Note">
                <i class="fa fa-chevron-left"></i> 《计算进化史：改变数学的命运》Note
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/04/math-human-civilization/" rel="prev" title="《数学与人类文明》Note">
                《数学与人类文明》Note <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">F.L.</p>
              <div class="site-description motion-element" itemprop="description">Note on computer, IT, art, education, etc.</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">F.L.</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Symbols count total: </span>
    
    <span title="Symbols count total">110k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    
    <span title="Reading time total">1:40</span>
  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.1</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="Total Visitors">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="Total Views">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  
  
  <script id="dsq-count-scr" src="https://feilinx.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "http://feilinx.com/2019/02/23/burn-cpu-calories-2/";
    this.page.identifier = "2019/02/23/burn-cpu-calories-2/";
    this.page.title = 'Burn CPU\'s Calories (2)';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://feilinx.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  

</body>
</html>
